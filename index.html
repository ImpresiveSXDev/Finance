<!DOCTYPE html>
<html>
<head>
  <title>Wizualizacja danych z CSV</title>

  <!-- Zaladuj biblioteke D3.js -->
  <script src="https://d3js.org/d3.v5.min.js"></script>

  <!-- Zaladuj biblioteke Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
</head>
<body>
  <h1>Wizualizacja danych z CSV</h1>

  <!-- Tutaj znajdzie sie wizualizacja danych -->
  <canvas id="chart"></canvas>

  <script>
    // Funkcja do wczytania pliku CSV
    function loadCSV(path) {
      // Przygotuj obiekt do przechowywania danych
      var data = {};

      // Wczytaj plik CSV za pomoca D3.js
      d3.csv(path, function(error, csv) {
        if (error) throw error;

        // Przetworz dane z pliku CSV
        csv.forEach(function(d) {
          // Grupuj dane po dacie i typie wydatku
          var date = d.data;
          var type = d.typ;

          // Jezeli jeszcze nie ma takiej grupy, to utworz nowa
          if (!data[date]) data[date] = {};
          if (!data[date][type]) data[date][type] = 0;

          // Dodaj wydatki do odpowiedniej grupy
          data[date][type] += parseInt(d.wydatki);
        });

        // Wygeneruj dane dla wizualizacji
        var chartData = {
          labels: Object.keys(data), // Dostepne daty
          datasets: []
        };
        Object.keys(data).forEach(function(date) {
          // Dostepne typy wydatkow dla danej daty
          var types = Object.keys(data[date]);

          // Dodaj nowy zestaw danych do wizualizacji
          chartData.datasets.push({
            label: date,
            data: types.map(function(type) {
              // Pobierz wydatki dla danego typu
              return data[date][type];
            }),
            backgroundColor: types.map(function(type) {
              // Dla kazdego typu wydatku, przydziel losowy kolor
              return '#'+Math.floor(Math.random()*16777215).toString(16);
            })
        });
        });

                // Stworz wizualizacje za pomoca Chart.js
                var ctx = document.getElementById('chart').getContext('2d');
        var chart = new Chart(ctx, {
          type: 'bar',
          data: chartData,
          options: {
            title: {
              display: true,
              text: 'Wydatki'
            },
            legend: {
              display: false
            },
            scales: {
              xAxes: [{
                stacked: true // Ustaw wyswietlanie slupkow na stosie
              }],
              yAxes: [{
                stacked: true // Ustaw wyswietlanie slupkow na stosie
              }]
            }
          }
        });
      });
    }

// Po zaladowaniu strony, wczytaj plik CSV
window.addEventListener('load', function() {
  // Podaj adres URL pliku CSV zamiast lokalnego pliku
  loadCSV('https://raw.githubusercontent.com/ImpresiveSXDev/Finance/main/Expenses_2022.csv');
});
  </script>
</body>
</html>
